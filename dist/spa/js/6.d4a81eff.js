(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{b733:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.userLogged?o("q-page",[o("div",{staticClass:"q-py-lg tab-rdo"},[e.userLogged.admin?e._e():o("q-tabs",{staticClass:"text-secondary",attrs:{"active-color":"accent","indicator-color":"accent",dense:"","narrow-indicator":"",align:"justify"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[o("q-tab",{attrs:{ripple:!1,name:"rdos",label:"RDO di tuo interesse"}}),o("q-tab",{attrs:{ripple:!1,name:"yourRdos",label:"Rdo da te caricate"}})],1),e.userLogged.admin?o("h5",{staticClass:"text-center no-margin"},[e._v("Lista RDO vista ADMIN")]):e._e(),o("div",[o("q-tab-panels",{staticClass:"full-width",attrs:{animated:"","transition-prev":"scale","transition-next":"scale"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[o("q-tab-panel",{attrs:{name:"rdos"}},[e.userLogged.admin&&e.boardRdosLoaded?o("div",[o("div",{staticClass:"q-pa-lg"},[o("table-rdo",{attrs:{allRdos:!0,filtered:!1},on:{resetSelectedRdo:function(t){e.selectedRdo=null},openSelectedRdo:e.openSelectedRdo,openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1)]):e._e(),!e.userLogged.admin&&e.boardFilteredRdosLoaded?o("div",[o("div",{staticClass:"q-pa-lg"},[o("table-rdo",{attrs:{allRdos:!0,filtered:!0},on:{resetSelectedRdo:function(t){e.selectedRdo=null},openSelectedRdo:e.openSelectedRdo,openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1)]):e._e(),e.userLogged.admin&&!e.boardRdosLoaded?o("div",{staticClass:"flex column justify-center items-center q-pt-xl"},[o("h5",{staticClass:"text-center no-margin q-pb-lg"},[e._v("Nessuna RDO trovata")])]):e._e(),e.userLogged.admin||e.boardFilteredRdosLoaded?e._e():o("div",{staticClass:"flex column justify-center items-center q-pt-xl"},[o("h5",{staticClass:"text-center no-margin q-pb-lg"},[e._v("Nessuna RDO trovata corrispondente ai parametri da te scelti in fase di registrazione")])]),o("modal",{attrs:{"selected-rdo":e.selectedRdo,"class-obj":e.classObj,modal:e.modal,"is-maximized":e.isMaximized,component:e.modalComponent,title:e.modalTitle},on:{"update:modal":function(t){e.modal=t}}})],1),o("q-tab-panel",{attrs:{name:"yourRdos"}},[o("user-rdos")],1)],1)],1)],1)]):e._e()},s=[],d=(o("e6cf"),o("ded3")),r=o.n(d),i=o("2f62"),n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-table",{attrs:{data:e.data,columns:e.columns,"row-key":"name",bordered:"","hide-bottom":!0,filter:e.filter,"filter-method":e.customFilter,separator:"cell",pagination:e.pagination},scopedSlots:e._u([{key:"top",fn:function(t){return[o("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.allRdos?o("div",{staticClass:"text-center",staticStyle:{margin:"auto","font-size":"1.2rem",color:"#165081"}},[e._v("RDO di tuo interesse")]):o("div",{staticClass:"text-center",staticStyle:{margin:"auto","font-size":"1.2rem",color:"#165081"}},[e._v("RDO da te caricate")]),o("div",{staticClass:"q-ml-auto"},[e.allRdos?e._e():o("q-btn",{attrs:{push:"",ripple:!1,label:"Carica RDO",color:"accent"},on:{click:function(t){return e.loadRdo()}}}),o("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:t.toggleFullscreen}})],1)]}},{key:"body",fn:function(t){return[o("q-tr",{attrs:{props:t}},[o("q-td",{key:"macroCategory",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.rdos.descMacro)+"\n      ")]),o("q-td",{key:"subCategory",staticStyle:{"white-space":"normal"},attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.rdos.description)+"\n      ")]),o("q-td",{key:"import",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.import)+"\n      ")]),o("q-td",{key:"regionOfInterest",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.regionOfInterest.description)+"\n      ")]),o("q-td",{key:"expirationDate",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(e.date.formatDate(t.row.rdo.expirationDate,"DD-MM-YYYY"))+"\n      ")]),o("q-td",{key:"viewRdo",attrs:{"auto-width":!0,props:t}},[o("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"search"},on:{click:function(o){return e.openRdo(t.row.rdo)}}})],1),!e.allRdos||e.userLogged.admin?o("q-td",{key:"deleteRdo",attrs:{"auto-width":!0,props:t}},[o("q-icon",{staticClass:"text-negative cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"delete_forever"},on:{click:function(o){return e.cancelRdo(t.row.rdo)}}})],1):e._e()],1)]}}])})},l=[],c=(o("e01a"),o("bd4c")),u={name:"TableRdo",props:["allRdos","filtered"],data(){return{pagination:{rowsPerPage:0},search:"",columns:[{name:"macroCategory",required:!0,label:"Macrocategoria",align:"center"},{name:"subCategory",required:!0,label:"Subcategoria",align:"center"},{name:"import",required:!0,label:"Importo",align:"center"},{name:"regionOfInterest",required:!0,label:"Regione",align:"center"},{name:"expirationDate",required:!0,label:"Scadenza",align:"center"},{name:"viewRdo",required:!0,label:"Visualizza RDO",align:"center"}],data:[],date:c["b"]}},methods:r()(r()({},Object(i["b"])(["deleteRdo","fetchUser","fetchAllRdos"])),{},{getData(e){this.data.length>0&&(this.data=[]),e.forEach((e=>{const t={rdo:e};this.data.push(t)}))},openRdo(e){this.$emit("openSelectedRdo",e)},loadRdo(){this.$emit("resetSelectedRdo"),this.$emit("openModal")},async cancelRdo(e){this.$q.loading.show();const t=this.userLogged.admin?e.user._id:this.userLogged._id,o={pathParam:e._id+"/"+t},a={pathParam:t};if(await this.deleteRdo(o),this.userLogged.admin){await this.fetchAllRdos();const e=this.filtered?this.boardFilteredRdos.filter((e=>e.user._id!==this.userLogged._id)):this.boardRdos.filter((e=>e.user._id!==this.userLogged._id));this.getData(e)}else await this.fetchUser(a),this.getData(this.userLogged.loadedRdos);this.$q.loading.hide()},customFilter(e,t){const o=t.search?t.search.toLowerCase():"",a=e.filter(((e,t)=>{let a=!1,s=!0;if(""!==o){s=!1;const t={};Object.entries(e.rdo).forEach((e=>{"rdos"===e[0]&&(t.descMacro=e[1].descMacro,t.subCategory=e[1].description),"regionOfInterest"===e[0]&&(t[e[0]]=e[1].description),"import"===e[0]&&(t[e[0]]=e[1])}));const a=Object.values(t),d=a.map((e=>e.toString().toLowerCase()));for(let e=0;e<d.length;e++)if(d[e].includes(o)){s=!0;break}}return a=!1,s&&(a=!0),a}));return a}}),computed:r()(r()({},Object(i["c"])({userLogged:"user",boardRdos:"boardRdos",boardFilteredRdos:"boardFilteredRdos"})),{},{filter(){return{search:this.search}}}),mounted(){if(!this.allRdos||this.userLogged.admin)this.getData(this.userLogged.loadedRdos),this.columns.push({name:"deleteRdo",required:!0,label:"Elimina RDO",align:"center"});else{const e=this.filtered?this.boardFilteredRdos.filter((e=>e.user._id!==this.userLogged._id)):this.boardRdos.filter((e=>e.user._id!==this.userLogged._id));this.getData(e)}},watch:{boardRdos:{deep:!0,handler(e,t){if(this.allRdos){const t=e.filter((e=>e.user._id!==this.userLogged._id));this.getData(t)}}},boardFilteredRdos:{deep:!0,handler(e,t){if(this.allRdos){const t=e.filter((e=>e.user._id!==this.userLogged._id));this.getData(t)}}},userLogged:{deep:!0,handler(e,t){e&&!this.allRdos&&this.getData(e.loadedRdos)}}}},h=u,p=o("2877"),m=o("eaac"),g=o("27f9"),b=o("0016"),R=o("9c40"),f=o("bd08"),_=o("db86"),q=o("eebe"),O=o.n(q),v=Object(p["a"])(h,n,l,!1,null,"40f77f10",null),y=v.exports;O()(v,"components",{QTable:m["a"],QInput:g["a"],QIcon:b["a"],QBtn:R["a"],QTr:f["a"],QTd:_["a"]});var C=o("714b"),L=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.userLogged?o("q-page",[o("div",{staticClass:"q-pa-lg"},[o("table-rdo",{on:{openSelectedRdo:e.openSelectedRdo,resetSelectedRdo:function(t){e.selectedRdo=null},openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1),o("modal",{attrs:{"selected-rdo":e.selectedRdo,"class-obj":e.classObj,modal:e.modal,"is-maximized":e.isMaximized,component:e.modalComponent,title:e.modalTitle},on:{"update:modal":function(t){e.modal=t}}})],1):e._e()},w=[],x={name:"UserRdos",components:{Modal:C["a"],TableRdo:y},data(){return{loadRdoClassObj:{"q-pa-none":!0},modalComponent:void 0,modalTitle:void 0,isMaximized:!1,modal:!1,selectedRdo:null,classObj:{}}},computed:r()({},Object(i["c"])({userLogged:"user"})),methods:{openModal(e,t,o,a){this.modalComponent=e,this.modalTitle=t,this.isMaximized=o,this.modal=!0,this.classObj=a},openSelectedRdo(e){this.selectedRdo=e,this.openModal("load-rdo","RDO di "+e.contractor,!0,this.loadRdoClassObj,!1)}}},j=x,D=o("9989"),S=Object(p["a"])(j,L,w,!1,null,"1602786a",null),M=S.exports;O()(S,"components",{QPage:D["a"]});var F={name:"Board",components:{UserRdos:M,TableRdo:y,Modal:C["a"]},data(){return{tab:"rdos",loadRdoClassObj:{"q-pa-none":!0},modalComponent:void 0,modalTitle:void 0,isMaximized:!1,modal:!1,classObj:{},boardRdosLoaded:!0,boardFilteredRdosLoaded:!0,selectedRdo:null}},methods:r()(r()({},Object(i["b"])(["fetchFilteredRdos","fetchAllRdos"])),{},{openModal(e,t,o,a){this.modalComponent=e,this.modalTitle=t,this.isMaximized=o,this.modal=!0,this.classObj=a},openSelectedRdo(e){this.selectedRdo=e,this.openModal("load-rdo","RDO di "+e.contractor,!0,this.loadRdoClassObj,!1)},async loadBoard(){this.$q.loading.show(),this.userLogged&&!this.userLogged.admin?(await this.fetchFilteredRdos(this.getFilters()),this.boardFilteredRdosLoaded=this.boardFilteredRdos.length>0):this.userLogged&&this.userLogged.admin&&(await this.fetchAllRdos(),this.boardRdosLoaded=this.boardRdos.length>0),this.$q.loading.hide()},getFilters(){const e=[],t=[],o=[],a=[],s=[],d=[],r=[],i=[],n=[];Object.entries(this.userLogged.rdos).forEach((l=>{"first"===l[0]&&(l[1].subCategory.forEach((t=>{e.push(t._id)})),l[1].imports.forEach((e=>{t.push(e)})),l[1].regionsOfInterest.forEach((e=>{o.push(e._id)}))),"second"===l[0]&&(l[1].subCategory.forEach((e=>{a.push(e._id)})),l[1].imports.forEach((e=>{s.push(e)})),l[1].regionsOfInterest.forEach((e=>{d.push(e._id)}))),"third"===l[0]&&(l[1].subCategory.forEach((e=>{r.push(e._id)})),l[1].imports.forEach((e=>{i.push(e)})),l[1].regionsOfInterest.forEach((e=>{n.push(e._id)})))}));const l={queryparams:{regionOfInterestIdFirst:o,rdoIdFirst:e,importsFirst:t}};return a.length>0&&(l.queryparams.regionOfInterestIdSecond=d,l.queryparams.rdoIdSecond=a,l.queryparams.importsSecond=s),r.length>0&&(l.queryparams.regionOfInterestIdThird=n,l.queryparams.rdoIdThird=r,l.queryparams.importsThird=i),l}}),computed:r()({},Object(i["c"])({userLogged:"user",boardRdos:"boardRdos",boardFilteredRdos:"boardFilteredRdos"})),watch:{boardRdos:{deep:!0,handler(e,t){e.length!==t.length&&(this.boardRdosLoaded=e.length>0)}},boardFilteredRdos:{deep:!0,handler(e,t){e.length!==t.length&&(this.boardFilteredRdosLoaded=e.length>0)}}},async mounted(){setTimeout((async()=>{await this.loadBoard()}),200)}},k=F,I=o("429b"),T=o("7460"),z=o("adad"),E=o("823b"),Q=Object(p["a"])(k,a,s,!1,null,"989f8f26",null);t["default"]=Q.exports;O()(Q,"components",{QPage:D["a"],QTabs:I["a"],QTab:T["a"],QTabPanels:z["a"],QTabPanel:E["a"]})}}]);