(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"34ab":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-xl"},[a("q-table",{attrs:{title:"Lista utenti",data:e.data,columns:e.columns,"row-key":"name",bordered:"",filter:e.filter,"filter-method":e.customFilter,separator:"cell",pagination:e.pagination},scopedSlots:e._u([{key:"top",fn:function(t){return[a("div",{staticClass:"col-2 q-table__title"},[e._v("Lista utenti")]),a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),a("q-btn",{staticClass:"q-ml-auto",attrs:{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:t.toggleFullscreen}})]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{key:"companyName",attrs:{"auto-width":!0,props:t}},[a("div",[e._v("\n            "+e._s(t.row.user.companyName)+"\n          ")]),a("q-icon",{staticClass:"text-secondary cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"search"},on:{click:function(a){return e.viewSelectedProfile(t.row.user)}}})],1),a("q-td",{key:"user",attrs:{"auto-width":!0,props:t}},[a("div",[e._v("\n            "+e._s(t.row.user.username)+"\n          ")])]),a("q-td",{key:"registrationDate",attrs:{"auto-width":!0,props:t}},[e._v("\n          "+e._s(e.date.formatDate(t.row.user.createdAt,"DD-MM-YYYY"))+"\n        ")]),a("q-td",{key:"blocked",attrs:{props:t}},[t.row.user.blocked?a("q-btn",{staticClass:"bg-warning text-white",attrs:{push:""},on:{click:function(a){return e.openConfirmDialog(t.row.user,"Sicuro di voler sbloccare l'utente selezionato?",e.update,!1,null)}}},[e._v("Sblocca")]):a("q-btn",{staticClass:"bg-warning text-white",attrs:{push:""},on:{click:function(a){return e.openConfirmDialog(t.row.user,"Sicuro di voler bloccare l'utente selezionato?",e.update,!0,null)}}},[e._v("Blocca")])],1),a("q-td",{key:"payed",attrs:{props:t}},[t.row.user.payed?a("div",{staticClass:"flex column items-center justify-around full-width"},[a("div",{staticClass:"text-negative",staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.getDaysLeftToEndSubscription(t.row.user)))]),a("q-icon",{staticClass:"text-positive cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"done"}})],1):a("div",[a("q-icon",{staticClass:"text-negative cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"error"}})],1)]),a("q-td",{key:"annual",attrs:{props:t}},[a("q-btn",{staticClass:"bg-accent text-white",attrs:{push:"",disable:t.row.user.payed},on:{click:function(a){return e.openConfirmDialog(t.row.user,"Sicuro di voler attivare l'abbonamento di un anno?",e.confirmUser,void 0,1)}}},[e._v("Attiva")])],1),a("q-td",{key:"biennial",attrs:{props:t}},[a("q-btn",{staticClass:"bg-secondary text-white",attrs:{push:"",disable:t.row.user.payed},on:{click:function(a){return e.openConfirmDialog(t.row.user,"Sicuro di voler attivare l'abbonamento di due anni?",e.confirmUser,void 0,2)}}},[e._v("Attiva")])],1),a("q-td",{key:"soaFile",attrs:{props:t}},[t.row.user.soaFile?a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.soaFile.Key)}}}):a("q-icon",{staticClass:"text-negative",attrs:{name:"remove"}})],1),a("q-td",{key:"isoFile",attrs:{props:t}},[t.row.user.isoFile?a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.isoFile.Key)}}}):a("q-icon",{staticClass:"text-negative",attrs:{name:"remove"}})],1),a("q-td",{key:"fgasFile",attrs:{props:t}},[t.row.user.fgasFile?a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.fgasFile.Key)}}}):a("q-icon",{staticClass:"text-negative",attrs:{name:"remove"}})],1),t.row.user.antimafiaFile?a("q-td",{key:"antimafiaFile",attrs:{props:t}},[a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.antimafiaFile.Key)}}})],1):e._e(),t.row.user.lendingFile?a("q-td",{key:"lendingFile",attrs:{props:t}},[a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.lendingFile.Key)}}})],1):e._e(),t.row.user.certificateFile?a("q-td",{key:"certificateFile",attrs:{props:t}},[a("div",{staticClass:"flex column items-center full-width"},[a("div",{staticClass:"text-negative text-center",staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.getDaysLeftToEndFile(t.row.user.certificateDate,t.row.user)))]),a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.certificateFile.Key)}}})],1)]):e._e(),t.row.user.durcRegolarityFile?a("q-td",{key:"durcRegolarityFile",attrs:{props:t}},[a("div",{staticClass:"flex column items-center full-width"},[a("div",{staticClass:"text-negative text-center",staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.getDaysLeftToEndFile(t.row.user.durcRegolarityDate,t.row.user)))]),a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"file_download"},on:{click:function(a){return e.downloadFile(t.row.user.durcRegolarityFile.Key)}}})],1)]):e._e(),a("q-td",{key:"delete",attrs:{props:t}},[a("q-icon",{staticClass:"text-negative cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"delete_forever"},on:{click:function(a){return e.openConfirmDialog(t.row.user,"Sicuro di voler eliminare l'utente selezionato?",e.removeUser)}}})],1)],1)]}}])}),a("modal",{attrs:{"class-obj":e.classObj,modal:e.modal,"is-maximized":e.isMaximized,"is-editing":e.isEditing,component:e.modalComponent,title:e.modalTitle,"is-admin":!0,"selected-user":e.selectedUser},on:{editSelectedUserSuccess:e.editSelectedUserSuccess,"update:modal":function(t){e.modal=t}}}),a("confirm-dialog",{attrs:{message:e.message,"data-obj":e.dataObj,callback:e.callback,confirm:e.confirm},on:{"update:confirm":function(t){e.confirm=t}}})],1)},s=[],n=(a("e6cf"),a("ded3")),r=a.n(n),o=a("2f62"),l=a("bd4c"),c=a("714b"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-dialog",{attrs:{persistent:""},on:{hide:e.hideDialog},model:{value:e.localConfirm,callback:function(t){e.localConfirm=t},expression:"localConfirm"}},[a("q-card",{staticClass:"q-pa-md"},[a("q-card-actions",{staticClass:"column",attrs:{align:"center"}},[a("div",{staticClass:"q-ml-sm q-pb-lg",staticStyle:{"font-size":"1.3rem"}},[e._v(e._s(e.message))]),a("div",{staticClass:"flex justify-around full-width"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{push:"",label:"Annulla",color:"negative"}}),a("q-btn",{attrs:{push:"",label:"Conferma",color:"positive"},on:{click:e.executeCallback}})],1)])],1)],1)},u=[],m={name:"ConfirmDialog",props:["confirm","callback","dataObj","message"],data(){return{localConfirm:this.confirm}},methods:{hideDialog(){this.$emit("update:confirm",this.localConfirm)},async executeCallback(){this.$emit("update:confirm",!1),await this.callback(this.dataObj)}},watch:{confirm(e,t){t!==e&&(this.localConfirm=e)}}},f=m,p=a("2877"),b=a("24e8"),g=a("f09f"),h=a("4b7e"),w=a("9c40"),y=a("7f67"),v=a("eebe"),C=a.n(v),q=Object(p["a"])(f,d,u,!1,null,"2e3b31e8",null),k=q.exports;C()(q,"components",{QDialog:b["a"],QCard:g["a"],QCardActions:h["a"],QBtn:w["a"]}),C()(q,"directives",{ClosePopup:y["a"]});var F={name:"Admin",components:{ConfirmDialog:k,Modal:c["a"]},data(){return{pagination:{rowsPerPage:0},subscriptionPeriod:null,haveToBlock:!1,message:void 0,dataObj:void 0,callback:void 0,confirm:!1,selectedUser:void 0,isEditing:!1,modal:!1,modalComponent:void 0,modalTitle:void 0,isMaximized:!1,classObj:{},viewProfileClassObj:{"bg-white":!0},search:"",date:l["b"],users:[],columns:[{name:"companyName",required:!0,label:"Ragione Sociale",align:"center",sortable:!0,headerClasses:"text-weight-bold"},{name:"user",required:!0,label:"Username",align:"center",sortable:!0,headerClasses:"text-weight-bold"},{name:"registrationDate",required:!0,label:"Data iscrizione",sortable:!0,align:"center"},{name:"blocked",required:!0,label:"Blocca/Sblocca",align:"center",headerClasses:"text-weight-bold"},{name:"payed",required:!0,label:"Abbonamento",align:"center"},{name:"annual",required:!0,label:"Annuale",align:"center"},{name:"biennial",required:!0,label:"Biennale",align:"center"},{name:"soaFile",label:"Soa File",align:"center"},{name:"isoFile",label:"Iso File",align:"center"},{name:"fgasFile",label:"FGas File",align:"center"},{name:"antimafiaFile",required:!0,label:"Antimafia File",align:"center"},{name:"lendingFile",required:!0,label:"Presentazione File",align:"center"},{name:"certificateFile",required:!0,label:"Certificato o Visura Camerale File",align:"center"},{name:"durcRegolarityFile",required:!0,label:"RegolaritÃ  Durc File",align:"center"},{name:"delete",required:!0,label:"Elimina",align:"center"}],data:[]}},computed:{filter(){return{search:this.search}}},methods:r()(r()({},Object(o["b"])(["fetchUsers","updateLoggedUser","deleteUser","fetchFile"])),{},{async editSelectedUserSuccess(){await this.loadUsers()},openConfirmDialog(e,t,a,i,s){this.haveToBlock=i,this.subscriptionPeriod=s,this.callback=a,this.dataObj=e,this.message=t,this.confirm=!0},openModal(e,t,a,i,s){this.modalComponent=e,this.modalTitle=t,this.isMaximized=a,this.modal=!0,this.classObj=i,this.isEditing=s},getData(){this.data.length>0&&(this.data=[]),this.users.forEach((e=>{if(!e.admin){const t={user:e};this.data.push(t)}}))},viewSelectedProfile(e){this.selectedUser=e,this.openModal("sign-in","MODIFICA UTENTE - VISTA ADMIN",!0,this.viewProfileClassObj,!0)},async downloadFile(e){const t={pathParam:e},a=await this.fetchFile(t);window.open(a.url)},confirmUser(e){e&&(e.payed=!0,e.subscriptionDate=new Date,1===this.subscriptionPeriod?e.annual=!0:e.biennial=!0,this.update(e))},async update(e){e.blocked=this.haveToBlock;const t={pathParam:e._id,body:e};await this.updateLoggedUser(t),await this.loadUsers()},async removeUser(e){this.$q.loading.show();const t={pathParam:e._id};await this.deleteUser(t),await this.loadUsers()},async loadUsers(){const{users:e}=await this.fetchUsers();this.users=e,this.getData(),this.$q.loading.hide()},getDaysLeftToEndSubscription(e){const t=e.annual?1:2,a=l["b"].addToDate(new Date(e.subscriptionDate),{year:t});return l["b"].getDateDiff(a,new Date,"days")>=0?"Scade tra: "+l["b"].getDateDiff(a,new Date,"days")+" giorni":"SCADUTO"},getDaysLeftToEndFile(e,t){return l["b"].getDateDiff(e,new Date,"days")>0?(t.needBlock=!0,"Scade tra: "+l["b"].getDateDiff(e,new Date,"days")+" giorni"):(t.needBlock=!0,"SCADUTO")},customFilter(e,t){const a=t.search?t.search.toLowerCase():"",i=e.filter(((e,t)=>{let i=!1,s=!0;if(""!==a){s=!1;const t=Object.values(e.user),i=t.map((e=>{if(null!=e)return e.toString().toLowerCase()}));for(let e=0;e<i.length;e++)if(null!=e&&i[e].includes(a)){s=!0;break}}return i=!1,s&&(i=!0),i}));return i}}),async mounted(){this.$q.loading.show(),await this.loadUsers()}},D=F,x=a("9989"),S=a("eaac"),_=a("27f9"),U=a("0016"),z=a("bd08"),T=a("db86"),j=Object(p["a"])(D,i,s,!1,null,"7d03ac6c",null);t["default"]=j.exports;C()(j,"components",{QPage:x["a"],QTable:S["a"],QInput:_["a"],QIcon:U["a"],QBtn:w["a"],QTr:z["a"],QTd:T["a"]})}}]);