(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{b733:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.userLogged?a("q-page",[a("div",{staticClass:"q-py-lg tab-rdo"},[e.userLogged.admin?e._e():a("q-tabs",{staticClass:"text-secondary",attrs:{"active-color":"primary",dense:"","indicator-color":"transparent","narrow-indicator":"",align:"justify"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[a("q-tab",{attrs:{name:"rdos",ripple:!1}},[a("div",{staticClass:"tab-to-select"},[e._v("Rdo di tuo interesse")])]),a("q-tab",{attrs:{name:"yourRdos",ripple:!1}},[a("div",{staticClass:"tab-to-select"},[e._v("Rdo da te caricate")])])],1),e.userLogged.admin?a("h5",{staticClass:"text-center no-margin"},[e._v("Lista RDO vista ADMIN")]):e._e(),a("div",[a("q-tab-panels",{staticClass:"full-width",attrs:{animated:"","transition-prev":"scale","transition-next":"scale"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[a("q-tab-panel",{attrs:{name:"rdos"}},[e.userLogged.admin&&e.boardRdosLoaded?a("div",[a("div",{staticClass:"q-pa-lg"},[a("table-rdo",{attrs:{allRdos:!0,filtered:!1},on:{resetSelectedRdo:function(t){e.selectedRdo=null},openSelectedRdo:e.openSelectedRdo,openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1)]):e._e(),!e.userLogged.admin&&e.boardFilteredRdosLoaded?a("div",[a("div",{staticClass:"q-pa-lg"},[a("table-rdo",{attrs:{allRdos:!0,filtered:!0},on:{resetSelectedRdo:function(t){e.selectedRdo=null},openSelectedRdo:e.openSelectedRdo,openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1)]):e._e(),e.userLogged.admin&&!e.boardRdosLoaded?a("div",{staticClass:"flex column justify-center items-center q-pt-xl"},[a("h5",{staticClass:"text-center no-margin q-pb-lg"},[e._v("Nessuna RDO trovata")])]):e._e(),e.userLogged.admin||e.boardFilteredRdosLoaded?e._e():a("div",{staticClass:"flex column justify-center items-center q-pt-xl"},[a("h5",{staticClass:"text-center no-margin q-pb-lg"},[e._v("Nessuna RDO trovata corrispondente ai parametri da te scelti in fase di registrazione")])]),a("modal",{attrs:{"selected-rdo":e.selectedRdo,"class-obj":e.classObj,modal:e.modal,"is-maximized":e.isMaximized,component:e.modalComponent,title:e.modalTitle},on:{"update:modal":function(t){e.modal=t}}})],1),a("q-tab-panel",{attrs:{name:"yourRdos"}},[a("user-rdos")],1)],1)],1)],1)]):e._e()},s=[],d=(a("e6cf"),a("ded3")),r=a.n(d),i=a("2f62"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-table",{attrs:{data:e.data,columns:e.columns,"row-key":"name",bordered:"",filter:e.filter,"filter-method":e.customFilter,separator:"cell",pagination:e.pagination},scopedSlots:e._u([{key:"top",fn:function(t){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!0),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e.allRdos?a("div",{staticClass:"text-center",staticStyle:{margin:"auto","font-size":"1.2rem",color:"#165081"}},[e._v("RDO di tuo interesse")]):a("div",{staticClass:"text-center",staticStyle:{margin:"auto","font-size":"1.2rem",color:"#165081"}},[e._v("RDO da te caricate")]),a("div",{staticClass:"q-ml-auto"},[e.allRdos?e._e():a("q-btn",{attrs:{push:"",ripple:!1,label:"Carica RDO",color:"accent"},on:{click:function(t){return e.loadRdo()}}}),a("q-btn",{staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:t.toggleFullscreen}})],1)]}},{key:"body",fn:function(t){return[a("q-tr",{attrs:{props:t}},[a("q-td",{key:"macroCategory",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.rdos.descMacro)+"\n      ")]),a("q-td",{key:"subCategory",staticStyle:{"white-space":"normal"},attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.rdos.description)+"\n      ")]),a("q-td",{key:"import",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.import)+"\n      ")]),a("q-td",{key:"regionOfInterest",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(t.row.rdo.regionOfInterest.description)+"\n      ")]),a("q-td",{key:"expirationDate",attrs:{"auto-width":!0,props:t}},[e._v("\n        "+e._s(e.date.formatDate(t.row.rdo.expirationDate,"DD-MM-YYYY"))+"\n      ")]),a("q-td",{key:"viewRdo",attrs:{"auto-width":!0,props:t}},[a("q-icon",{staticClass:"text-accent cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"search"},on:{click:function(a){return e.openRdo(t.row.rdo)}}})],1),!e.allRdos||e.userLogged.admin?a("q-td",{key:"deleteRdo",attrs:{"auto-width":!0,props:t}},[a("q-icon",{staticClass:"text-negative cursor-pointer",staticStyle:{"font-size":"2rem"},attrs:{name:"delete_forever"},on:{click:function(a){return e.cancelRdo(t.row.rdo)}}})],1):e._e()],1)]}}])})},l=[],c=(a("e01a"),a("bd4c")),u={name:"TableRdo",props:["allRdos","filtered"],data(){return{pagination:{rowsPerPage:0},search:"",columns:[{name:"macroCategory",required:!0,label:"Macrocategoria",align:"center"},{name:"subCategory",required:!0,label:"Subcategoria",align:"center"},{name:"import",required:!0,label:"Importo",align:"center"},{name:"regionOfInterest",required:!0,label:"Regione",align:"center"},{name:"expirationDate",required:!0,label:"Scadenza",align:"center"},{name:"viewRdo",required:!0,label:"Visualizza RDO",align:"center"}],data:[],date:c["b"]}},methods:r()(r()({},Object(i["b"])(["deleteRdo","fetchUser","fetchAllRdos"])),{},{getData(e){this.data.length>0&&(this.data=[]),e.forEach((e=>{const t={rdo:e};this.data.push(t)}))},openRdo(e){this.$emit("openSelectedRdo",e)},loadRdo(){this.$emit("resetSelectedRdo"),this.$emit("openModal")},async cancelRdo(e){this.$q.loading.show();const t=this.userLogged.admin?e.user._id:this.userLogged._id,a={pathParam:e._id+"/"+t},o={pathParam:t};if(await this.deleteRdo(a),this.userLogged.admin){await this.fetchAllRdos();const e=this.filtered?this.boardFilteredRdos.filter((e=>e.user._id!==this.userLogged._id)):this.boardRdos.filter((e=>e.user._id!==this.userLogged._id));this.getData(e)}else await this.fetchUser(o),this.getData(this.userLogged.loadedRdos);this.$q.loading.hide()},customFilter(e,t){const a=t.search?t.search.toLowerCase():"",o=e.filter(((e,t)=>{let o=!1,s=!0;if(""!==a){s=!1;const t={};Object.entries(e.rdo).forEach((e=>{"rdos"===e[0]&&(t.descMacro=e[1].descMacro,t.subCategory=e[1].description),"regionOfInterest"===e[0]&&(t[e[0]]=e[1].description),"import"===e[0]&&(t[e[0]]=e[1])}));const o=Object.values(t),d=o.map((e=>e.toString().toLowerCase()));for(let e=0;e<d.length;e++)if(d[e].includes(a)){s=!0;break}}return o=!1,s&&(o=!0),o}));return o}}),computed:r()(r()({},Object(i["c"])({userLogged:"user",boardRdos:"boardRdos",boardFilteredRdos:"boardFilteredRdos"})),{},{filter(){return{search:this.search}}}),mounted(){if(!this.allRdos||this.userLogged.admin)this.getData(this.userLogged.loadedRdos),this.columns.push({name:"deleteRdo",required:!0,label:"Elimina RDO",align:"center"});else{const e=this.filtered?this.boardFilteredRdos.filter((e=>e.user._id!==this.userLogged._id)):this.boardRdos.filter((e=>e.user._id!==this.userLogged._id));this.getData(e)}},watch:{boardRdos:{deep:!0,handler(e,t){if(this.allRdos){const t=e.filter((e=>e.user._id!==this.userLogged._id));this.getData(t)}}},boardFilteredRdos:{deep:!0,handler(e,t){if(this.allRdos){const t=e.filter((e=>e.user._id!==this.userLogged._id));this.getData(t)}}},userLogged:{deep:!0,handler(e,t){e&&!this.allRdos&&this.getData(e.loadedRdos)}}}},h=u,p=a("2877"),m=a("eaac"),g=a("27f9"),b=a("0016"),R=a("9c40"),f=a("bd08"),_=a("db86"),q=a("eebe"),v=a.n(q),O=Object(p["a"])(h,n,l,!1,null,"37a39639",null),C=O.exports;v()(O,"components",{QTable:m["a"],QInput:g["a"],QIcon:b["a"],QBtn:R["a"],QTr:f["a"],QTd:_["a"]});var y=a("714b"),L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.userLogged?a("q-page",[a("div",{staticClass:"q-pa-lg"},[a("table-rdo",{on:{openSelectedRdo:e.openSelectedRdo,resetSelectedRdo:function(t){e.selectedRdo=null},openModal:function(t){return e.openModal("load-rdo","Carica RDO",!0,e.loadRdoClassObj,!1)}}})],1),a("modal",{attrs:{"selected-rdo":e.selectedRdo,"class-obj":e.classObj,modal:e.modal,"is-maximized":e.isMaximized,component:e.modalComponent,title:e.modalTitle},on:{"update:modal":function(t){e.modal=t}}})],1):e._e()},w=[],x={name:"UserRdos",components:{Modal:y["a"],TableRdo:C},data(){return{loadRdoClassObj:{"q-pa-none":!0},modalComponent:void 0,modalTitle:void 0,isMaximized:!1,modal:!1,selectedRdo:null,classObj:{}}},computed:r()({},Object(i["c"])({userLogged:"user"})),methods:{openModal(e,t,a,o){this.modalComponent=e,this.modalTitle=t,this.isMaximized=a,this.modal=!0,this.classObj=o},openSelectedRdo(e){this.selectedRdo=e,this.openModal("load-rdo","RDO di "+e.contractor,!0,this.loadRdoClassObj,!1)}}},j=x,D=a("9989"),S=Object(p["a"])(j,L,w,!1,null,"1602786a",null),M=S.exports;v()(S,"components",{QPage:D["a"]});var F={name:"Board",components:{UserRdos:M,TableRdo:C,Modal:y["a"]},data(){return{tab:"rdos",loadRdoClassObj:{"q-pa-none":!0},modalComponent:void 0,modalTitle:void 0,isMaximized:!1,modal:!1,classObj:{},boardRdosLoaded:!0,boardFilteredRdosLoaded:!0,selectedRdo:null}},methods:r()(r()({},Object(i["b"])(["fetchFilteredRdos","fetchAllRdos"])),{},{openModal(e,t,a,o){this.modalComponent=e,this.modalTitle=t,this.isMaximized=a,this.modal=!0,this.classObj=o},openSelectedRdo(e){this.selectedRdo=e,this.openModal("load-rdo","RDO di "+e.contractor,!0,this.loadRdoClassObj,!1)},async loadBoard(){this.$q.loading.show(),this.userLogged&&!this.userLogged.admin?(await this.fetchFilteredRdos(this.getFilters()),this.boardFilteredRdosLoaded=this.boardFilteredRdos.length>0):this.userLogged&&this.userLogged.admin&&(await this.fetchAllRdos(),this.boardRdosLoaded=this.boardRdos.length>0),this.$q.loading.hide()},getFilters(){const e=[],t=[],a=[],o=[],s=[],d=[],r=[],i=[],n=[];Object.entries(this.userLogged.rdos).forEach((l=>{"first"===l[0]&&(l[1].subCategory.forEach((t=>{e.push(t._id)})),l[1].imports.forEach((e=>{t.push(e)})),l[1].regionsOfInterest.forEach((e=>{a.push(e._id)}))),"second"===l[0]&&(l[1].subCategory.forEach((e=>{o.push(e._id)})),l[1].imports.forEach((e=>{s.push(e)})),l[1].regionsOfInterest.forEach((e=>{d.push(e._id)}))),"third"===l[0]&&(l[1].subCategory.forEach((e=>{r.push(e._id)})),l[1].imports.forEach((e=>{i.push(e)})),l[1].regionsOfInterest.forEach((e=>{n.push(e._id)})))}));const l={queryparams:{regionOfInterestIdFirst:a,rdoIdFirst:e,importsFirst:t}};return o.length>0&&(l.queryparams.regionOfInterestIdSecond=d,l.queryparams.rdoIdSecond=o,l.queryparams.importsSecond=s),r.length>0&&(l.queryparams.regionOfInterestIdThird=n,l.queryparams.rdoIdThird=r,l.queryparams.importsThird=i),l}}),computed:r()({},Object(i["c"])({userLogged:"user",boardRdos:"boardRdos",boardFilteredRdos:"boardFilteredRdos"})),watch:{boardRdos:{deep:!0,handler(e,t){e.length!==t.length&&(this.boardRdosLoaded=e.length>0)}},boardFilteredRdos:{deep:!0,handler(e,t){e.length!==t.length&&(this.boardFilteredRdosLoaded=e.length>0)}}},async mounted(){setTimeout((async()=>{await this.loadBoard()}),200)}},k=F,I=a("429b"),T=a("7460"),z=a("adad"),E=a("823b"),Q=Object(p["a"])(k,o,s,!1,null,"05ba3b1b",null);t["default"]=Q.exports;v()(Q,"components",{QPage:D["a"],QTabs:I["a"],QTab:T["a"],QTabPanels:z["a"],QTabPanel:E["a"]})}}]);